generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model approval_workflows {
  id              String      @id
  leave_type_id   String      @unique
  requires_hr     Boolean     @default(false)
  min_days_for_hr Int?
  created_at      DateTime    @default(now())
  updated_at      DateTime
  leave_types     leave_types @relation(fields: [leave_type_id], references: [id], onDelete: Cascade)
}

model departments {
  id          String   @id
  name        String   @unique
  description String?
  created_at  DateTime @default(now())
  users       users[]
}

model leave_balances {
  id            String      @id
  user_id       String
  leave_type_id String
  year          Int
  allocated     Int         @default(0)
  used          Int         @default(0)
  pending       Int         @default(0)
  created_at    DateTime    @default(now())
  updated_at    DateTime
  leave_types   leave_types @relation(fields: [leave_type_id], references: [id])
  users         users       @relation(fields: [user_id], references: [id])

  @@unique([user_id, leave_type_id, year])
}

model leave_types {
  id                    String              @id
  name                  String              @unique
  description           String?
  default_days_per_year Int
  requires_approval     Boolean             @default(true)
  is_active             Boolean             @default(true)
  created_at            DateTime            @default(now())
  approval_workflows    approval_workflows?
  leave_balances        leave_balances[]
  leaves                leaves[]
}

model leaves {
  id                                      String      @id
  requester_id                            String
  leave_type_id                           String
  start_date                              DateTime    @db.Date
  end_date                                DateTime    @db.Date
  total_days                              Int
  reason                                  String
  status                                  LeaveStatus @default(pending)
  reviewer_id                             String?
  review_comment                          String?
  reviewed_at                             DateTime?
  created_at                              DateTime    @default(now())
  updated_at                              DateTime
  current_approval_step                   String      @default("manager")
  hr_comment                              String?
  hr_reviewed_at                          DateTime?
  hr_reviewer_id                          String?
  manager_comment                         String?
  manager_reviewed_at                     DateTime?
  manager_reviewer_id                     String?
  users_leaves_hr_reviewer_idTousers      users?      @relation("leaves_hr_reviewer_idTousers", fields: [hr_reviewer_id], references: [id])
  leave_types                             leave_types @relation(fields: [leave_type_id], references: [id])
  users_leaves_manager_reviewer_idTousers users?      @relation("leaves_manager_reviewer_idTousers", fields: [manager_reviewer_id], references: [id])
  users_leaves_requester_idTousers        users       @relation("leaves_requester_idTousers", fields: [requester_id], references: [id])
  users_leaves_reviewer_idTousers         users?      @relation("leaves_reviewer_idTousers", fields: [reviewer_id], references: [id])

  @@index([requester_id])
  @@index([start_date, end_date])
  @@index([status])
}

model users {
  id                                       String           @id
  email                                    String           @unique
  password_hash                            String
  first_name                               String
  last_name                                String
  role                                     Role             @default(employee)
  is_active                                Boolean          @default(true)
  department_id                            String?
  created_at                               DateTime         @default(now())
  updated_at                               DateTime
  leave_balances                           leave_balances[]
  leaves_leaves_hr_reviewer_idTousers      leaves[]         @relation("leaves_hr_reviewer_idTousers")
  leaves_leaves_manager_reviewer_idTousers leaves[]         @relation("leaves_manager_reviewer_idTousers")
  leaves_leaves_requester_idTousers        leaves[]         @relation("leaves_requester_idTousers")
  leaves_leaves_reviewer_idTousers         leaves[]         @relation("leaves_reviewer_idTousers")
  departments                              departments?     @relation(fields: [department_id], references: [id])
}

enum LeaveStatus {
  pending
  approved
  rejected
  cancelled
  pending_hr
}

enum Role {
  employee
  manager
  admin
}
